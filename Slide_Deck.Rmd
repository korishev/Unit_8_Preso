---
title: "Unit_8_Preso"
author: "Morgan Nelson"
date: "February 17, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# The following commands WILL INSTALL PACKAGES ON YOUR SYSTEM, if needed.
# Some would consider this rude.  Apologies in advance.
if(!require(tidyverse)) {install.packages("tidyverse"); library(tidyverse)}
if(!require(usmap)) {install.packages("usmap"); library(usmap)}
if(!require(DMwR)) {install.packages("DMwR"); library(DMwR)}
```
Greetings Mr. CEO and Mr. CFO, other distinguished guests.

Given the Beer and Brewery data, our research intends to answer several compelling questions for the business:
1. How many breweries are present in each state?
```{r import_beer_data}
beers <- read.csv("./Beers.csv")
breweries <- read.csv("Breweries.csv")

# Question 2
# Merge beer data with the breweries data. 
# Print the first 6 observations and the last six observations to check the merged file.

# Merge the two data frames into one
data <- merge(beers,breweries,by.x = "Brewery_id", by.y = "Brew_ID")
data <- data %>% 
  rename(Beer = Name.x) %>%       # clean up munged names from merge
  rename(Brewery = Name.y) %>%    # clean up munged names from merge
  rename(Brewery_ID = Brewery_id) # Make anything with _ID the same

head(data, n = 6)
tail(data,n = 6)

```

```{r plot_brewery_map}
# The following lines create a table that has the number of breweries
# per state, then tidys up the columns into a format the usmaps library
# understands
brewery_count_by_state <- data %>% group_by(State) %>% summarise(count=n())
brewery_count_by_state$State = as.character(brewery_count_by_state$State)
brewery_count_by_state$State = str_trim(brewery_count_by_state$State)
 brewery_count_by_state = brewery_count_by_state %>% mutate(state=State)
 brewery_count_by_state = brewery_count_by_state[,3:2]
 
brewery_count_by_state %>% 
  ggplot(aes(x=state, y = count)) + 
  geom_bar(stat="identity") + 
  labs(title = "Breweries by State", x = "State", y="Breweries") + coord_flip()
```

While accurate this graphic is less than helpful, so we've put the breweries on a map.

```{r map_the_breweries} 
# Now that we have tidy brewery by state data, let's make a map
plot_usmap(data=brewery_count_by_state, values = "count", labels=T) + 
  scale_fill_continuous(low="white", high="blue", name = "Breweries", label = scales::comma) +
  theme(legend.position = "right")+
  theme(panel.background = element_rect(colour = "black")) +
  labs(title = "Breweries by State")
```
Let's get a better look at the northern east cost, it is a bit compressed
```{r east_coast_breweries }

# let's get a better look at the east coast...
plot_usmap(data=brewery_count_by_state, values = "count", labels=T, include = c(.new_england, .mid_atlantic)) + 
  scale_fill_continuous(low="white", high="blue", name = "Breweries", label = scales::comma) +
  theme(legend.position = "right")+
  theme(panel.background = element_rect(colour = "black")) +
  labs(title = "Breweries by State")

```
Be carefule here, where Pennsylvania has the highest number of breweries on this map, is in still only half the number of colorado on the previous slide, even though they are the same color.

To perform the rest of the analysis, the data was checked for a number of inconsistencies including missing values.  Over half of the records(1405 of 2410) in the dataset did not have values for the IBU, and 62 of the entries did not have a value for ABV.

To allow us to continue without removing any of the records for missing values, it was decided to impute the data with a k-NN on beers in the same "Style".

```{r impute dta}
beer_styles <- unique(data$Style)

imputed_beers = data.frame()

for(i in 1:1) {
#  View(data %>% filter(Style == beer_styles[i]) %>% filter(!is.na(IBU)))
  local <- data %>% filter(Style == beer_styles[i]) %>% knnImputation()
  class(local)
#  View(data %>% filter(Style == beer_styles[i]) %>% select(c(ABV,IBU)) )
}
```
